global
    log stdout format raw local0 info

defaults
    mode http
    timeout connect 5s
    timeout client 50s
    timeout server 50s

frontend http-in
    bind *:80
    
    # Route Matrix API calls to Synapse
    acl is_matrix path_beg /_matrix
    acl is_matrix path_beg /_synapse
    use_backend synapse_backend if is_matrix

    # Route Auth calls to MAS
    acl is_auth path_beg /auth
    acl is_auth path_beg /.well-known/openid-configuration
    use_backend mas_backend if is_auth

    # Default: Route everything else to Element Web
    default_backend element_backend

backend synapse_backend
    server synapse synapse.railway.internal:8008

backend mas_backend
    server mas mas.railway.internal:8080

backend element_backend
    server element element-web.railway.internal:80
